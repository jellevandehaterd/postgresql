---
# tasks file for postgresql

# Variable configuration.
- include: variables.yml

# Setup/install tasks.
- include: setup-Alpine.yml
  when: ansible_os_family == 'Alpine'

- include: initialize.yml
- include: configure.yml

- name: Check postgresql status
  debug: msg="{{ lookup('pipe', 'su -c \"'+ postgresql_bin_path +'/pg_ctl -- status\" postgres') }}"
  register: postgresql_status
  ignore_errors: True

- name: Start postgresql
  command: 'gosu postgres {{ postgresql_bin_path }}/pg_ctl -- start -s -w -t 10 -l {{postgresql_log_path}}/postgresql.log'
  when: "'server is running' not in postgresql_status.msg"

- debug: msg="{{ lookup('pipe', 'su -c \"'+ postgresql_bin_path +'/pg_ctl -- status\" postgres') }}"


# Configure PostgreSQL.
- include: databases.yml
- include: users.yml

